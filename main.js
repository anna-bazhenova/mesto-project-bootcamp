(()=>{"use strict";var e=function(e,t){document.querySelector("#error-".concat(e.id)).textContent="",e.classList.remove(t.inputErrorClass)},t=function(e,t){document.querySelector("#error-".concat(e.id)).textContent=e.validationMessage,e.classList.add(t.inputErrorClass)},n=function(e,t){var n=e.querySelector(t.submitButtonSelector);e.checkValidity()?(n.disabled=!1,n.classList.remove(t.inactiveButtonClass)):(n.disabled=!0,n.classList.add(t.inactiveButtonClass))},o=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",c)},r=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",c)},c=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");r(t)}},a={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-6",headers:{authorization:"06dd5fb3-5e2f-4d1c-9ed0-e0e8756ddf10","Content-Type":"application/json"}},i=function(e){return e.ok?e.json():(console.dir(e.json()),Promise.reject("Ошибка: ".concat(e.status)))},u=document.querySelector("#cardTemplate").content.querySelector(".element"),l=document.querySelector(".popup-image"),s=document.querySelector(".popup-image__image"),d=document.querySelector(".popup-image__caption"),f=document.querySelector(".popup_confirmation"),m=f.querySelector(".form__submit-button"),p=function(e,t){var n=u.cloneNode(!0),c=n.querySelector(".element__image"),p=n.querySelector(".element__place-name"),h=n.querySelector(".element__like-button"),_=n.querySelector(".element__delete-button"),v=n.querySelector(".element__number-likes");return c.src=e.link,c.alt=e.name,p.textContent=e.name,v.textContent=e.likes.length,e.likes.some((function(e){return e._id===t}))&&h.classList.add("element__like-button_active"),h.addEventListener("click",(function(){var t;h.classList.contains("element__like-button_active")?(t=e._id,fetch("".concat(a.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:a.headers}).then(i)).then((function(e){h.classList.toggle("element__like-button_active"),v.textContent=e.likes.length})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(a.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:a.headers}).then(i)}(e._id).then((function(e){h.classList.toggle("element__like-button_active"),v.textContent=e.likes.length})).catch((function(e){console.log(e)}))})),e.owner._id===t?_.addEventListener("click",(function(){o(f),m.addEventListener("click",(function(t){var o;t.preventDefault(),(o=e._id,fetch("".concat(a.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:a.headers}).then(i)).then((function(){n.remove(),r(f)})).catch((function(e){console.log(e)}))}),{once:!0})})):_.remove(),c.addEventListener("click",(function(){s.src=c.src,s.alt=p.textContent,d.textContent=p.textContent,o(l)})),n},h=function(e,t,n){t.textContent=e?"Сохранение...":n},_=document.querySelector(".profile__edit-button"),v=document.querySelector(".popup_edit-form"),y=document.querySelector(".profile__name"),b=document.querySelector(".profile__profession"),S=document.querySelector(".profile__avatar"),C=document.querySelector(".profile__avatar-container"),g=document.querySelector(".popup_change-avatar"),q=document.forms.changeAvatar.linkAvatar,k=document.forms.changeAvatar,E=document.forms.editProfile.nameProfile,L=document.forms.editProfile.professionProfile,x=document.forms.editProfile,P=document.querySelector(".elements"),A=document.querySelector(".profile__add-button"),U=document.querySelector(".popup_add-cards"),T=document.forms.addCard,D=document.forms.addCard.nameCard,w=document.forms.addCard.linkCard,B=document.querySelectorAll(".close-button"),j=document.querySelectorAll(".popup"),N=document.forms.addCard.querySelector(".form__submit-button"),O=document.forms.editProfile.querySelector(".form__submit-button"),J=document.forms.changeAvatar.querySelector(".form__submit-button"),H={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_inactive",inputErrorClass:"form__input_invalid",errorClass:"error-message"};!function(o){document.querySelectorAll(o.formSelector).forEach((function(r){r.querySelectorAll(o.inputSelector).forEach((function(c){c.addEventListener("input",(function(){!function(o,r,c){r.validity.valid?e(r,c):t(r,c),n(o,c)}(r,c,o)}))}))}))}(H),fetch("".concat(a.baseUrl,"/users/me"),{headers:a.headers}).then(i).then((function(e){y.textContent=e.name,b.textContent=e.about,S.src=e.avatar,z(e._id)})).catch((function(e){console.log(e)}));var z=function(e){return fetch("".concat(a.baseUrl,"/cards"),{headers:a.headers}).then(i).then((function(t){t.forEach((function(t){return P.append(p(t,e))}))})).catch((function(e){console.log(e)}))};A.addEventListener("click",(function(){n(T,H),o(U)})),T.addEventListener("submit",(function(e){e.preventDefault();var t,n=N.textContent;h(!0,N),(t={name:D.value,link:w.value},fetch("".concat(a.baseUrl,"/cards"),{method:"POST",headers:a.headers,body:JSON.stringify({name:t.name,link:t.link})}).then(i)).then((function(t){P.prepend(p(t,t.owner._id)),r(U),e.target.reset()})).catch((function(e){console.log(e)})).finally((function(){h(!1,N,n)}))})),C.addEventListener("click",(function(){n(k,H),o(g)})),k.addEventListener("submit",(function(e){e.preventDefault();var t,n=J.textContent;h(!0,J),(t=q.value,fetch("".concat(a.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:t})}).then(i)).then((function(t){S.src=t.avatar,r(g),e.target.reset()})).catch((function(e){console.log(e)})).finally((function(){h(!1,J,n)}))})),_.addEventListener("click",(function(){E.value=y.textContent,L.value=b.textContent,n(x,H),o(v)})),x.addEventListener("submit",(function(e){e.preventDefault();var t=O.textContent;h(!0,O),function(e,t){return fetch("".concat(a.baseUrl,"/users/me"),{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then(i)}(E.value,L.value).then((function(e){y.textContent=e.name,b.textContent=e.about,r(v)})).catch((function(e){console.log(e)})).finally((function(){h(!1,O,t)}))})),B.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return r(t)}))})),j.forEach((function(e){e.addEventListener("click",(function(t){t.target===t.currentTarget&&r(e)}))}))})();